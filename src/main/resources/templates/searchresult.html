<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ja">

<head>
	<meta charset="UTF-8">
	<title>商品検索結果</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body>
	<div id="wrapper">

		<div th:replace="~{header :: siteHeader}"></div>

		<main class="container my-5">
			
			<!-- 検索フォーム -->
			<div class="row justify-content-center mb-5">
				<div class="col-md-8 text-center">
					<form th:action="@{/search}" method="get" class="d-flex align-items-center">
						<input type="text" name="keyword" class="form-control me-2" placeholder="商品名を検索"
							th:value="${keyword}">
						<button type="submit" class="btn btn-primary px-4"
							style="white-space: nowrap; display: inline-flex; align-items: center; justify-content: center;">検索</button>
					</form>
				</div>
			</div>

			<h2>検索結果</h2>

			<!-- 商品が見つからない場合 -->
			<div th:if="${#lists.isEmpty(resultList)}" class="alert alert-warning text-center">
				見つかりませんでした。
			</div>

			<!-- 商品一覧 -->
			<div class="row row-cols-1 row-cols-md-3 g-4" th:if="${!#lists.isEmpty(resultList)}">
				<div class="col" th:each="item : ${resultList}">
					<div class="card h-100 shadow-sm">

						<!-- ✅ from=search & keyword を付与 -->
						<a th:href="@{/detail/{id}(id=${item.goodsId}, from='search', keyword=${searchForm.keyword})}">
							<img th:src="${item.imageUrl}" class="card-img-top" alt="商品画像">
						</a>

						<div class="card-body text-center">
							<h5 class="card-title" th:text="${item.goodsName}"></h5>

							<!-- ✅ ボタン側も同じ -->
							<a th:href="@{/detail/{id}(id=${item.goodsId}, from='search', keyword=${searchForm.keyword})}"
								class="btn btn-outline-primary mt-2">
								詳細を見る
							</a>
						</div>

					</div>
				</div>
			</div>

			<!-- ✅ ページネーション（検索条件を保持） -->
			<nav th:if="${totalPages > 1}" class="mt-4">
				<ul class="pagination justify-content-center">

					<!-- 前へ -->
					<li class="page-item" th:classappend="${currentPage == 0} ? 'disabled'">
						<a class="page-link"
							th:href="@{/search(genre=${searchForm.genreId}, page=${currentPage - 1}, keyword=${searchForm.keyword})}">
							前へ
						</a>
					</li>

					<!-- ページ番号 -->
					<li class="page-item" th:each="i : ${#numbers.sequence(0, totalPages - 1)}"
						th:classappend="${i == currentPage} ? 'active'">
						<a class="page-link"
							th:href="@{/search(genre=${searchForm.genreId}, page=${i}, keyword=${searchForm.keyword})}"
							th:text="${i + 1}">
						</a>
					</li>

					<!-- 次へ -->
					<li class="page-item" th:classappend="${currentPage == totalPages - 1} ? 'disabled'">
						<a class="page-link"
							th:href="@{/search(genre=${searchForm.genreId}, page=${currentPage + 1}, keyword=${searchForm.keyword})}">
							次へ
						</a>
					</li>

				</ul>
			</nav>

		</main>

		<div th:replace="~{footer :: siteFooter}"></div>

	</div>
</body>

</html>