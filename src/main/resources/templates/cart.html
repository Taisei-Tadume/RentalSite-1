<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ja">

<head>
	<meta charset="UTF-8">
	<title>カート</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body>
	<div>
		<div th:replace="~{header :: siteHeader}"></div>

		<main class="container my-5">

			<!-- 検索フォーム -->
			<div class="row justify-content-center mb-5">
				<div class="col-md-8 text-center">
					<form th:action="@{/search}" method="get" class="d-flex align-items-center">
						<input type="text" name="keyword" class="form-control me-2" placeholder="商品名を検索"
							th:value="${keyword}">
						<button type="submit" class="btn btn-primary px-4"
							style="white-space: nowrap; display: inline-flex; align-items: center; justify-content: center;">検索</button>
					</form>
				</div>
			</div>

			<h2 class="mb-4 text-center">ショッピングカート</h2>

			<!-- カートが空の場合 -->
			<div th:if="${#lists.isEmpty(cart)}" class="text-center text-danger mb-4">
				<span th:text="${errorMessage}">カートに商品が入っていません。</span>
			</div>

			<!-- カートに商品がある場合 -->
			<div th:if="${!#lists.isEmpty(cart)}">
				<table class="table table-bordered align-middle">
					<thead class="table-light">
						<tr>
							<th style="width:70%">商品名</th>
							<th style="width:30%" class="text-center">数量・操作</th>
						</tr>
					</thead>
					<tbody>
						<tr th:each="item : ${cart}">
							<td th:text="${item.goods.title}"></td>

							<!-- 数量 & 削除を一つの枠へ -->
							<td class="text-center">
								<div class="d-flex justify-content-center align-items-center gap-2">
									<button type="button" class="btn btn-outline-secondary btn-sm"
										th:onclick="'sendCartAction(\'/cart/decrease\',' + ${item.goods.goodsId} + ');'">−</button>

									<span class="fw-bold px-2" th:text="${item.quantity}"></span>

									<button type="button" class="btn btn-outline-secondary btn-sm"
										th:onclick="'sendCartAction(\'/cart/increase\',' + ${item.goods.goodsId} + ');'">＋</button>

									<button type="button" class="btn btn-danger btn-sm"
										th:onclick="'sendCartAction(\'/cart/remove\',' + ${item.goods.goodsId} + ');'">🗑</button>
								</div>
							</td>
						</tr>
					</tbody>
				</table>


			</div>

			<!-- 注文内容確認 -->
			<div class="text-center mt-5">
				<form th:action="@{/order/confirm}" method="post">
					<button class="btn btn-primary btn-lg">注文内容を確認</button>
				</form>
			</div>

		</main>

		<div th:replace="footer :: siteFooter"></div>
	</div>
	<script>
		// ページ遷移せ		ず数量変更・削除を実行
		function sendCartAction(ur			oodsId) {
							l, {
				method:				
				header					ontent-Type': 'application/x-www-form-urlencoded'
							bo				dsId=' + goodsId
			})
							n((				 {
					// セッシ					るため再描画のみ
					location.					;
				});
		}
	</script>
</body>

</html>