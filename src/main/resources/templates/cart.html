<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ja">

<head>
	<meta charset="UTF-8">
	<meta name="_csrf" th:content="${_csrf.token}">
	<meta name="_csrf_header" th:content="${_csrf.headerName}">
	<title>カート</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body>
	<div>
		<div th:replace="~{header :: siteHeader}"></div>

		<main class="container my-5">

			<h2 class="mb-4 text-center">ショッピングカート</h2>

			<!-- カートが空場合 -->
			<div th:if="${#lists.isEmpty(cart)}" class="text-center text-danger mb-4">
				<span>カートに商品が入っていません。</span>
			</div>

			<!-- カートに商品がある場合 -->
			<div th:if="${!#lists.isEmpty(cart)}">
				<table class="table table-bordered align-middle">
					<thead class="table-light">
						<tr>
							<th style="width:70%">商品名</th>
							<th style="width:30%" class="text-center">数量・操作</th>
						</tr>
					</thead>
					<tbody>
						<tr th:each="item : ${cart}">
							<td th:text="${item.goods.goodsName}"></td>

							<td class="text-center">
								<div class="d-flex justify-content-center align-items-center gap-2">

									<button type="button" class="btn btn-outline-secondary btn-sm"
										th:onclick="'sendCartAction(\'/cart/decrease\',' + ${item.goods.goodsId} + ');'">−</button>

									<span class="fw-bold px-2" th:text="${item.quantity}"></span>

									<button type="button" class="btn btn-outline-secondary btn-sm"
										th:onclick="'sendCartAction(\'/cart/increase\',' + ${item.goods.goodsId} + ');'">＋</button>

									<button type="button" class="btn btn-danger btn-sm"
										th:onclick="'sendCartAction(\'/cart/remove\',' + ${item.goods.goodsId} + ');'">🗑</button>

								</div>
							</td>
						</tr>
					</tbody>
				</table>
			</div>

			<div class="text-center mt-5">
				<form th:action="@{/order/confirm}" method="get">
					<button class="btn btn-primary btn-lg">注文内容を確認</button>
				</form>
			</div>

		</main>

		<div th:replace="~{footer :: siteFooter}"></div>

	</div>

	<script>
		function sendCartAction(url, goodsId) {
			const token = document.querySelector('meta[name="_csrf"]').content;
			const header = document.querySelector('meta[name="_csrf_header"]').content;

			fetch(url, {
				method: 'POST',
				headers: {
					'Content-Type': 'application/x-www-form-urlencoded',
					[header]: token
				},
				body: 'goodsId=' + goodsId
			}).then(() => location.reload());
		}

	</script>

</body>

</html>